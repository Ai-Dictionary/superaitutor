class ExamInterface {
    constructor() {
        this.sidenav = 0;
        this.termination = 0;
        this.temp = '';
        this.currentPaper = null;
        this.currentCategory = 1;

        this.root = document.getElementById('root');
        this.questions1 = [];
        this.questions2 = [];
        this.questions3 = [];
        ExamInterface.instance = this;
        this.user();
    }

    user() {
        // window.addEventListener("blur", () => {
        //     if (new URL(window.location['href']).hostname !== '') {
        //         showAlert(`You should change window ${this.termination + 1} time, please stop move otherwise your exam should cancel.`);
        //         this.termination++;
        //     }
        // });

        // window.addEventListener("focus", () => {
        //     if (new URL(window.location['href']).hostname !== '') {
        //         if (this.termination > 3 && this.termination < 5) {
        //             alert("Your exam is cancelled for unwanted movement!");
        //         }
        //     }
        // });

        this.setExamData();
        if (this.deviceCheck() !== 2) {
            this.toggleSidenav();
        }
    }

    toggleSidenav() {
        if (this.sidenav === 0) {
            if (this.deviceCheck() !== 2) {
                document.querySelector(".right-component").style.width = "0%";
                document.querySelector(".sidenav-toggler").style.position = "absolute";
                document.querySelector(".sidenav-toggler").style.top = "58%";
                document.querySelector(".sidenav-toggler").style.left = "90%";
                setTimeout(() => {
                    document.querySelector(".right-component").style.display = "none";
                }, 1000);
            } else {
                document.querySelector(".right-component").style.width = "0%";
                document.querySelector(".left-component").style.width = "100%";
                document.querySelector(".sidenav-toggler").style.position = "absolute";
                document.querySelector(".sidenav-toggler").style.top = "58%";
                document.querySelector(".sidenav-toggler").style.left = "98%";
            }
            document.querySelector(".sidenav-toggler").innerHTML = '<i class="fa fa-arrow-left"></i>';
            this.sidenav++;
        } else {
            if (this.deviceCheck() !== 2) {
                document.querySelector(".right-component").style.display = "block";
                document.querySelector(".right-component").style.width = "70%";
                document.querySelector(".sidenav-toggler").style.position = "absolute";
                document.querySelector(".sidenav-toggler").style.top = "58%";
                document.querySelector(".sidenav-toggler").style.left = "22%";
            } else {
                document.querySelector(".right-component").style.width = "20%";
                document.querySelector(".left-component").style.width = "80%";
                document.querySelector(".sidenav-toggler").style.position = "absolute";
                document.querySelector(".sidenav-toggler").style.top = "58%";
                document.querySelector(".sidenav-toggler").style.left = "78%";
            }
            document.querySelector(".sidenav-toggler").innerHTML = '<i class="fa fa-arrow-right"></i>';
            this.sidenav--;
        }
    }

    static closeAlert() {
        document.querySelector(".alert").style.top = "-8%";
        setTimeout(() => {
            document.querySelector(".alert").style.display = "none";
        }, 1000);
    }

    getPaper() {
        let raw_paper = document.querySelector('.raw_info').innerText;
        let paper = JSON.parse(raw_paper, null, 2);
        for (const key of Object.keys(paper.question)) {
            if (key.startsWith("set")) {
                paper.question[key] = paper.question[key].map(item => {
                    const [text, choices, answer] = item;
                    return new Question(text, choices, answer);
                });
            }
        }
        this.currentPaper = paper;
        raw_paper = '';
    }

    deviceCheck() {
        const details = navigator.userAgent;
        let regexp = /android|iphone|kindle|ipad/i;
        let regexc = /windows|linux|macintosh/i;
        let isMobileDevice = regexp.test(details);
        let isComputer = regexc.test(details);
        if (isMobileDevice) {
            return 0;
        } else {
            if (isComputer) {
                return 2;
            }
            return 1;
        }
    }

    setExamData() {
        this.getPaper();
        setTimeout(() => {
            const engine = new ExamEngine(this.currentPaper, this.currentCategory, this.root);
            engine.reorderSection();
            engine.populate(1);
            exam.examTimerStart();
        }, 1000);
    }

    static get_currentPaper() {
        return ExamInterface.instance?.currentPaper || [];
    }
}

new ExamInterface();

function showAlert(message) {
    document.querySelector(".alert").style.display = "block";
    document.getElementById("alert-message").innerHTML = message;
    setTimeout(() => {
        document.querySelector(".alert").style.top = "8%";
    }, 100);
}
